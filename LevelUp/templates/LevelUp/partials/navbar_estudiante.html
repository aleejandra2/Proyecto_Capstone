{% load static %}

<!-- === NAVBAR === -->
<header class="acad-navbar seussbar topbar">
  <div class="container topbar-inner">

    <!-- IZQUIERDA: selector de asignatura -->
    <div class="topbar-left">
      <div class="subject-selector has-dropdown">

        <!-- BotÃ³n principal (asignatura actual) -->
        {% if asignaturas %}
        {% with asignaturas.0 as current_asig %}
        <button type="button" class="subject-main">
          <span class="subject-icon">
            <!-- icono actual -->
            <img src="{% static current_asig.icono %}" alt="" class="subject-main-img">
          </span>
          <span class="subject-name">
            {{ current_asig.nombre }}
          </span>
          <i class="bi bi-caret-down-fill subject-caret"></i>
        </button>
        {% endwith %}
        {% else %}
        <!-- Si no hay asignaturas, dejamos el texto por defecto -->
        <button type="button" class="subject-main">
          <span class="subject-icon">
            <i class="bi bi-calculator"></i>
          </span>
          <span class="subject-name">
            Selecciona una asignatura
          </span>
          <i class="bi bi-caret-down-fill subject-caret"></i>
        </button>
        {% endif %}

        <!-- Dropdown con todas las asignaturas -->
        <div class="subject-dropdown" role="menu" aria-label="Seleccionar asignatura">
          <ul class="subject-list">
            {% for asig in asignaturas %}
            <li>
              <a href="#" class="subject-item js-subject" data-slug="{{ asig.slug|default:asig.nombre|slugify }}"
                data-name="{{ asig.nombre }}" data-icon="{% static asig.icono %}">
                <span class="subject-egg">
                  <img src="{% static asig.icono %}" alt="" class="egg-img">
                </span>
                <span class="subject-label">{{ asig.nombre }}</span>
              </a>
            </li>
            {% empty %}
            <li class="subject-empty text-muted px-3 py-2">Sin asignaturas</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <!-- CENTRO:  nivel / puntos -->
<div class="topbar-center">
  <div class="status-pill">
    <div class="status-block">
      <div class="hud-level">
        Nivel {{ estudiante_actual.nivel|default:1 }}
      </div>
    </div>

    <span class="status-divider"></span>

    <div class="status-block">
      <span class="status-text">
        {{ estudiante_actual.puntos|default:0 }} pts
      </span>
    </div>

    <span class="status-divider"></span>

    <div class="status-block coins-block">
      <span class="coin-icon">ðŸª™</span>
      <span class="status-value">
        {{ estudiante_actual.monedas|default:0 }}
      </span>
    </div>
  </div>
</div>

    <!-- DERECHA: iconos, usuario y botÃ³n -->
    <div class="topbar-right">

      <!-- Icono medalla -->
      <button type="button" class="circle-badge">
        <i class="bi bi-award-fill"></i>
      </button>

      <!-- Separador -->
      <span class="topbar-divider"></span>

      <!-- Usuario -->
      <div class="dropdown user-dropdown">
        <button class="user-pill" data-bs-toggle="dropdown" aria-expanded="false" aria-label="MenÃº de usuario">
          <span class="user-avatar">
            {{ request.user.first_name|default:request.user.username|first|upper }}
          </span>
          <span class="user-name d-none d-md-inline">
            {{ request.user.get_full_name|default:request.user.username }}
          </span>
          <i class="bi bi-caret-down-fill ms-1"></i>
        </button>

        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" href="{% url 'perfil' %}"><i class="bi bi-person"></i> Mi perfil</a></li>
          <li><a class="dropdown-item" href="{% url 'recompensas' %}"><i class="bi bi-award"></i> Recompensas</a></li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><a class="dropdown-item" href="{% url 'logout' %}"><i class="bi bi-box-arrow-right"></i> Cerrar sesiÃ³n</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</header>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const subjectMain = document.querySelector(".subject-main");
  if (!subjectMain) return;

  const mainImg  = subjectMain.querySelector(".subject-icon img.subject-main-img");
  const mainName = subjectMain.querySelector(".subject-name");

  document.querySelectorAll(".subject-item.js-subject").forEach(function (item) {
    item.addEventListener("click", function (e) {
      e.preventDefault(); // que no haga salto a "#"

      const name = item.dataset.name;
      const icon = item.dataset.icon;

      if (mainName && name) {
        mainName.textContent = name;
      }
      if (mainImg && icon) {
        mainImg.src = icon;
      }

      // opcional: marcar seleccionado en el dropdown
      document.querySelectorAll(".subject-item.js-subject.is-active")
              .forEach(el => el.classList.remove("is-active"));
      item.classList.add("is-active");
    });
  });
});
</script>
