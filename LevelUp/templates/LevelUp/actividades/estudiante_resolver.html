{% extends "LevelUp/base.html" %}
{% block title %}{{ actividad.titulo }}{% endblock %}
{% block content %}
<div class="container py-3">

    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} mb-3">{{ message }}</div>
    {% endfor %}
    {% endif %}

    <h1 class="h4 mb-1">{{ actividad.titulo }}</h1>
    <p class="text-muted">{{ actividad.descripcion }}</p>

    <form method="post" enctype="multipart/form-data" class="card p-3">
        {% csrf_token %}

        {% for item in actividad.items.all %}
        <div class="mb-4">
            <h2 class="h6">{{ forloop.counter }}. {{ item.enunciado }}</h2>
            {% if item.imagen %}
            <img src="{{ item.imagen.url }}" class="img-fluid mb-2" alt="Imagen del ítem">
            {% endif %}

            {% if item.tipo == 'mcq' %}
            {# Opción múltiple: datos.opciones y datos.correctas (índices) #}
            {% for op in item.datos.opciones %}
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="item_{{ item.pk }}" value="{{ forloop.counter0 }}"
                    id="op{{ item.pk }}_{{ forloop.counter0 }}">
                <label class="form-check-label" for="op{{ item.pk }}_{{ forloop.counter0 }}">{{ op }}</label>
            </div>
            {% endfor %}

            {% elif item.tipo == 'tf' %}
            <div class="form-check">
                <input class="form-check-input" type="radio" name="item_{{ item.pk }}" value="true"
                    id="tf_t_{{ item.pk }}">
                <label class="form-check-label" for="tf_t_{{ item.pk }}">Verdadero</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="item_{{ item.pk }}" value="false"
                    id="tf_f_{{ item.pk }}">
                <label class="form-check-label" for="tf_f_{{ item.pk }}">Falso</label>
            </div>

            {% elif item.tipo == 'text' %}
            <textarea name="item_{{ item.pk }}" class="form-control" rows="3"
                placeholder="Escribe tu respuesta"></textarea>

            {% elif item.tipo == 'interactive' or item.tipo == 'game' %}
            {% if item.datos.url %}
            <div class="ratio ratio-16x9 mb-2">
                <iframe src="{{ item.datos.url }}" title="Contenido interactivo" allowfullscreen></iframe>
            </div>
            {% else %}
            <div class="alert alert-warning">No hay URL configurada para este contenido.</div>
            {% endif %}
            <input type="hidden" name="item_{{ item.pk }}" value="done">
            <small class="text-muted">Interactúa con el contenido y luego envía.</small>

            {% elif item.tipo == 'image' %}
            <input type="text" name="item_{{ item.pk }}" class="form-control"
                placeholder="Describe la imagen o responde la pregunta">

            {% else %}
            <div class="alert alert-secondary">Tipo de ítem no soportado: {{ item.tipo }}</div>
            {% endif %}

            <div class="small text-muted mt-1">Puntaje: {{ item.puntaje }}</div>
        </div>
        {% empty %}
        <div class="alert alert-info">Esta actividad aún no tiene ítems.</div>
        {% endfor %}

        <div class="d-flex gap-2">
            <button class="btn btn-success">Enviar actividad</button>
            <a class="btn btn-outline-secondary" href="{% url 'estudiante_lista' %}">Volver</a>
        </div>
    </form>
</div>
{% endblock %}