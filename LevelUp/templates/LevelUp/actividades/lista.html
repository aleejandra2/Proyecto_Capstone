{% extends "LevelUp/base.html" %}
{% block title %}Actividades · LevelUp{% endblock %}

{% block content %}
<main class="min-h-screen">
  <div class="container py-3">

    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} mb-3">{{ message }}</div>
    {% endfor %}
    {% endif %}

    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h4 m-0">Actividades</h1>
      <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">← Volver</a>
    </div>

    <div class="list-group">
      {% for act in actividades %}
      <div class="list-group-item">
        <div class="d-flex justify-content-between align-items-start gap-3">
          <div class="flex-grow-1">
            <h5 class="mb-1">{{ act.titulo|default:"Actividad sin título" }}</h5>
            <p class="text-muted mb-2">{{ act.descripcion|default:"Sin descripción" }}</p>

            <div class="small text-muted d-flex flex-wrap gap-3">
              <span>Tipo: {{ act.get_tipo_display }}</span>
              <span>Dificultad: {{ act.get_dificultad_display|default:act.dificultad }}</span>
              <span>XP: {{ act.xp_total|default:0 }}</span>
              <span>
                Estado:
                {% if act.es_publicada %}
                <span class="text-success">Publicada</span>
                {% else %}
                <span class="text-secondary">Borrador</span>
                {% endif %}
              </span>
              {% if act.fecha_publicacion %}<span>Pub: {{ act.fecha_publicacion|date:"d/m/Y H:i" }}</span>{% endif %}
              {% if act.fecha_cierre %}<span>Cierra: {{ act.fecha_cierre|date:"d/m/Y H:i" }}</span>{% endif %}
            </div>
          </div>

          <div class="text-end">
            {# Si eres docente, muestra Editar #}
            {% if request.user.rol == "Docente" %}
            <div class="mb-2">
              <a class="btn btn-sm btn-outline-primary" href="{% url 'actividad_editar' act.pk %}">Editar</a>
            </div>
            {% endif %}

            {# Si eres estudiante, muestra Jugar cuando esté publicada #}
            {% if request.user.rol == "Estudiante" %}
            {% if act.es_publicada %}
            <a class="btn btn-sm btn-success" href="{% url 'resolver_play' act.pk %}">Jugar</a>
            {% else %}
            <button class="btn btn-sm btn-secondary" disabled>Borrador</button>
            {% endif %}
            {% endif %}
          </div>
        </div>
      </div>
      {% empty %}
      <div class="alert alert-info">No hay actividades disponibles.</div>
      {% endfor %}
    </div>

  </div>
</main>
{% endblock %}

