{% extends "LevelUp/base.html" %}
{% load static %}
{% block title %}Ranking · LevelUp{% endblock %}

{% block content %}
<main class="min-h-screen">
  <div class="container py-3">

    <div class="league-card">
      <div class="league-tabs">
        <button class="league-tab is-active">
          Ranking General
        </button>
      </div>

      <div class="league-inner">
        {% if ranking_rows %}
          <!-- Cabecera -->
          <div class="league-head-row">
            <div class="league-col league-col--pos">Posición:</div>
            <div class="league-col league-col--trainer">Nombre del estudiante:</div>
            <div class="league-col league-col--score">Rango / Actividades:</div>
          </div>

          <!-- Lista -->
          <ul class="league-list">
            {% for row in ranking_rows %}
            <li class="league-row
                       {% if forloop.first %} is-leader{% endif %}
                       {% if row.usuario == request.user %} is-me{% endif %}">
              
              <!-- Posición -->
              <div class="league-col league-col--pos">
                {% if forloop.first %}
                  <i class="bi bi-trophy-fill league-trophy"></i>
                {% else %}
                  <span class="league-rank">{{ row.posicion }}º</span>
                {% endif %}
              </div>

              <!-- Estudiante -->
              <div class="league-col league-col--trainer">
                <div class="league-player">
                  <div class="league-avatar">
                    {% if row.foto %}
                      <img src="{{ row.foto.url }}" alt="Avatar" class="league-avatar-img">
                    {% else %}
                      <span class="league-avatar-fallback">
                        {{ row.iniciales }}
                      </span>
                    {% endif %}
                  </div>
                  <span class="league-name">
                    {{ row.nombre }}
                  </span>
                </div>
              </div>

              <!-- Rango + actividades -->
              <div class="league-col league-col--score">
                <span class="league-score">
                  {{ row.rango }}<br>
                  <small>{{ row.actividades }} actividad(es) completada(s)</small>
                </span>
              </div>
            </li>
            {% endfor %}
          </ul>

          <!-- Footer: info del jugador actual -->
          <div class="league-footer">
            <div class="league-footer-pill">
              <span class="league-footer-pos">
                {% if mi_posicion %}
                  {{ mi_posicion }}º
                {% else %}
                  —
                {% endif %}
              </span>
              <span class="league-footer-text">
                Tu rango:
                <strong>{{ perfil.rango_timo|default:"Timo Explorador" }}</strong>
                · Actividades:
                <strong>{{ perfil.actividades_completadas|default:0 }}</strong>
              </span>
            </div>
          </div>

        {% else %}
          <div class="py-4 text-center text-muted">
            Aún no hay estudiantes con actividades registradas. ¡Sé el primero en completar una! ✨
          </div>
        {% endif %}
      </div>
    </div>

  </div>

  <a href="{% url 'dashboard' %}" class="timo-home-btn" aria-label="Volver al inicio">
    <img src="{% static 'LevelUp/img//icons/timo_bolita.png' %}" alt="Volver al inicio">
  </a>
</main>
{% endblock %}
