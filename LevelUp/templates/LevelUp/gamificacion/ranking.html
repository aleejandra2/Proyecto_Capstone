{% extends "LevelUp/base.html" %}
{% load static %}
{% block title %}Ranking ¬∑ LevelUp{% endblock %}

{% block content %}
<main class="min-h-screen">
  <div class="container py-3">

    <div class="league-card">
      <!-- Pesta√±as superiores -->
      <div class="league-tabs">
        <button class="league-tab is-active">
          üåç Liga General
        </button>
      </div>

      <div class="league-inner">
        {% if estudiantes_top %}
          <!-- Cabecera de columnas -->
          <div class="league-head-row">
            <div class="league-col league-col--pos">Posici√≥n:</div>
            <div class="league-col league-col--trainer">Nombre del estudiante:</div>
            <div class="league-col league-col--score">Puntuaci√≥n:</div>
          </div>

          <!-- Lista de posiciones -->
          <ul class="league-list">
            {% for e in estudiantes_top %}
            <li class="league-row
                       {% if forloop.first %} is-leader{% endif %}
                       {% if e.usuario == request.user %} is-me{% endif %}">
              
              <!-- Columna posici√≥n -->
              <div class="league-col league-col--pos">
                {% if forloop.first %}
                  <i class="bi bi-trophy-fill league-trophy"></i>
                {% else %}
                  <span class="league-rank">{{ forloop.counter }}¬∫</span>
                {% endif %}
              </div>

              <!-- Columna entrenador (foto + nombre) -->
              <div class="league-col league-col--trainer">
                <div class="league-player">
                  <div class="league-avatar">
                    {% if e.foto_perfil %}
                      <img src="{{ e.foto_perfil.url }}" alt="Avatar" class="league-avatar-img">
                    {% else %}
                      <span class="league-avatar-fallback">
                        {{ e.usuario.first_name|default:e.usuario.username|slice:":2"|upper }}
                      </span>
                    {% endif %}
                  </div>
                  <span class="league-name">
                    {{ e.usuario.get_full_name|default:e.usuario.username }}
                  </span>
                </div>
              </div>

              <!-- Columna puntuaci√≥n -->
              <div class="league-col league-col--score">
                <span class="league-score">
                  {{ e.puntos|default:0 }} pts
                </span>
              </div>
            </li>
            {% endfor %}
          </ul>

          <!-- Pie: resumen del jugador actual (opcional) -->
          <div class="league-footer">
            <div class="league-footer-pill">
              <span class="league-footer-pos">
                {% if mi_posicion %}
                  {{ mi_posicion }}¬∫
                {% else %}
                  ‚Äî
                {% endif %}
              </span>
              <span class="league-footer-text">
                Tu puntuaci√≥n:
                <strong>{{ estudiante_actual.puntos|default:0 }} pts</strong>
              </span>
            </div>
          </div>

        {% else %}
          <div class="py-4 text-center text-muted">
            A√∫n no hay estudiantes con puntaje. ¬°S√© el primero en sumar puntos! ‚ú®
          </div>
        {% endif %}
      </div>
    </div>

  </div>

  {# Bot√≥n flotante Timo #}
  <a href="{% url 'dashboard' %}" class="timo-home-btn" aria-label="Volver al inicio">
    <img src="{% static 'LevelUp/img//icons/timo_bolita.png' %}" alt="Volver al inicio">
  </a>
</main>
{% endblock %}
