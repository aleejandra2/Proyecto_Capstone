{% extends "LevelUp/base.html" %}
{% load static %}

{% block title %}Recompensas ¬∑ LevelUp{% endblock %}

{% block content %}
<main class="min-h-screen rewards-page">
  <div class="container py-4">

    {# ================= HEADER / HERO ================= #}
    <section class="rewards-hero mb-4">
      <div class="rewards-hero-inner">

        <!-- LADO IZQUIERDO: texto + tarjetas -->
        <div class="rewards-hero-text">
          <div class="rewards-heading">
            <h1 class="rewards-title">
              üéÅ Tus recompensas
            </h1>

            <p class="rewards-subtitle">
              Alumno, sigue jugando para conseguir m√°s logros y medallas de Timo. üêæ
            </p>
          </div>

          {% if perfil %}
          <div class="rewards-kpi-row rewards-kpi-row--single">
            <div class="rewards-kpi-card">
              <div class="kpi-label">Actividades completadas</div>
              <div class="kpi-value">
                {{ perfil.actividades_completadas|default:0 }}
              </div>
              {% if perfil.actividades_para_siguiente_rango > 0 %}
              <div class="kpi-hint">
                Te faltan <strong>{{ perfil.actividades_para_siguiente_rango }}</strong>
                actividad(es) para el siguiente rango.
              </div>
              {% else %}
              <div class="kpi-hint">
                ¬°Ya est√°s en el rango m√°ximo, H√©roe Legendario! üåü
              </div>
              {% endif %}
            </div>
          </div>
          {% else %}
          <p class="rewards-subtitle" style="text-align:center;">
            Juega actividades para comenzar a ganar recompensas y rangos con Timo. üêæ
          </p>
          {% endif %}


        </div>

        <!-- LADO DERECHO: Timo -->
        <div class="rewards-hero-illustration d-none d-md-flex">
          <div class="timo-badge">

            {% if perfil %}
            {% if perfil.rango_numero == 1 %}
            <img src="{% static 'LevelUp/img/timo/Timo_explorador.png' %}" alt="Timo Explorador" class="timo-badge-img">
            {% elif perfil.rango_numero == 2 %}
            <img src="{% static 'LevelUp/img/timo/Timo_guardian.png' %}" alt="Timo Guardi√°n" class="timo-badge-img">
            {% elif perfil.rango_numero == 3 %}
            <img src="{% static 'LevelUp/img/timo/Timo_guardian.png' %}" alt="Timo Guardian" class="timo-badge-img">
            {% else %}
            <img src="{% static 'LevelUp/img/timo/Timo_legendario.png' %}" alt="Timo H√©roe Legendario"
              class="timo-badge-img">
            {% endif %}
            {% else %}
            <img src="{% static 'LevelUp/img/timo/Timo_guardian.png' %}" alt="Timo Guardi√°n" class="timo-badge-img">
            {% endif %}

            <div class="timo-badge-rank">
              {% if perfil %}
              {{ perfil.rango_timo }}
              {% else %}
              Timo Explorador
              {% endif %}
            </div>
          </div>
        </div>

      </div>
    </section>

    {# ================= GRID DE RECOMPENSAS ================= #}
    <section>
      <h2 class="h5 mb-3">
        Tus logros y medallas
      </h2>

      {% if recompensas %}
      <div class="rewards-grid">
        {% for r in recompensas %}
        {% if r.id in desbloqueadas_ids %}
        {# -------- TARJETA DESBLOQUEADA -------- #}
        <article class="reward-card reward-card--unlocked">
          <div class="reward-card-inner">
            <div class="reward-card-badge">‚úÖ Desbloqueada</div>

            <div class="reward-card-icon">
              <img src="{% static 'LevelUp/img/icons/estrella.webp' %}" alt="{{ r.nombre }}">
            </div>

            <h3 class="reward-card-title">
              {{ r.nombre }}
            </h3>

            {% if r.condicion_texto %}
            <p class="reward-card-condicion">
              {{ r.condicion_texto }}
            </p>
            {% endif %}

            {% if r.descripcion %}
            <p class="reward-card-descripcion">
              {{ r.descripcion }}
            </p>
            {% endif %}

            <div class="reward-card-tag">
              {{ r.get_tipo_display|default:"Logro" }}
            </div>
          </div>
        </article>

        {% else %}
        {# -------- TARJETA BLOQUEADA -------- #}
        <article class="reward-card reward-card--locked">
          <div class="reward-card-inner">
            <div class="reward-card-badge reward-card-badge--locked">
              üîí Bloqueada
            </div>

            <div class="reward-card-icon reward-card-icon--locked">
              <img src="{% static 'LevelUp/img/icons/estrella.webp' %}" alt="{{ r.nombre }}">
            </div>

            <h3 class="reward-card-title">
              {{ r.nombre }}
            </h3>

            {% if r.condicion_texto %}
            <p class="reward-card-condicion">
              {{ r.condicion_texto }}
            </p>
            {% endif %}

            <div class="reward-card-locked-hint">
              Completa las actividades necesarias para desbloquear este logro.
            </div>

            <div class="reward-card-tag reward-card-tag--locked">
              {{ r.get_tipo_display|default:"Logro" }}
            </div>
          </div>
        </article>
        {% endif %}
        {% endfor %}
      </div>
      {% else %}
      <div class="text-center text-muted py-4">
        A√∫n no hay recompensas configuradas. üí´
      </div>
      {% endif %}
    </section>
  </div>

  {# Bot√≥n flotante de regreso #}
  <a href="{% url 'dashboard' %}" class="timo-home-btn" aria-label="Volver al inicio">
    <img src="{% static 'LevelUp/img/icons/timo_bolita.png' %}" alt="Volver al inicio">
  </a>
</main>
{% endblock %}